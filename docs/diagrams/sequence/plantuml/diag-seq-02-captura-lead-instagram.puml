@startuml

title FokusLead - Sequencia Captura Lead Instagram

actor Lead
participant "Instagram Graph API" as Instagram
participant "Webhook Controller" as Webhook
participant "Integracao Service" as Integracao
participant "Lead Service" as LeadSvc
database "CRM DB" as DB
participant "Auditoria Service" as Audit
participant "Notificacao Service" as Notif

Lead -> Instagram : envia mensagem
Instagram -> Webhook : POST /webhook (evento)
Webhook -> Integracao : valida assinatura\nnormaliza payload
Integracao -> LeadSvc : upsertLead + registrarInteracao
LeadSvc -> DB : consulta lead por identificador
alt lead nao existe
  LeadSvc -> DB : cria lead
else lead existe
  LeadSvc -> DB : atualiza status/interesse
end
LeadSvc -> DB : registra interacao
LeadSvc -> Audit : grava auditoria
LeadSvc -> Notif : notifica corretor
Webhook --> Instagram : 200 OK

@enduml
