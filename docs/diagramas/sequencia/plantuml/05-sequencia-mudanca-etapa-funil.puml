@startuml

title FokusLead - Sequencia Mudanca de Etapa no Funil

actor Corretor
participant "Frontend" as Front
participant "Funil Service" as FunilSvc
database "CRM DB" as DB
participant "Auditoria Service" as Audit
participant "Notificacao Service" as Notif

Corretor -> Front : mover oportunidade de etapa
Front -> FunilSvc : solicitar mudanca de etapa
FunilSvc -> DB : buscar oportunidade e etapa atual
FunilSvc -> DB : validar regra de transicao
alt transicao invalida
  FunilSvc --> Front : erro de regra
else transicao valida
  FunilSvc -> DB : atualizar etapa
  FunilSvc -> Audit : grava auditoria
  FunilSvc -> Notif : notifica gestor
  FunilSvc --> Front : etapa atualizada
end

@enduml
